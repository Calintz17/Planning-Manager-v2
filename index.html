<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ROMAN | Resource Optimization & Management Allocation Network</title>

  <!-- Police: Helvetica (fallbacks système) -->
  <style>html, body { font-family: Helvetica, Arial, sans-serif; }</style>

  <!-- Styles globaux -->
  <link rel="stylesheet" href="./styles.css"/>
</head>
<body>
  <!-- Header / Tabs -->
  <header class="app-header">

  <div class="site-title">
    <span class="brand">ROMAN</span>
    <span class="tagline">Resource Optimization &amp; Management Allocation Network</span>
  </div>

    <nav class="tabs">
      <!-- IMPORTANT COULEUR DES TABS : voir styles.css (variable --btn / #1E5631) -->
      <button class="tab-btn active" data-tab="attendance">Attendance</button>
      <button class="tab-btn" data-tab="weekly">Weekly Planning</button>
      <button class="tab-btn" data-tab="agents">Agents</button>
      <button class="tab-btn" data-tab="tasks">Tasks</button>
      <button class="tab-btn" data-tab="forecast-section">Forecast</button>
      <button class="tab-btn" data-tab="regulation">Regulation</button>
    </nav>
  </header>

  <!-- Main panels -->
  <main class="app-main container">
    <!-- ATTENDANCE (v3.2) -->
    <section id="attendance" class="tab-panel">
      <div class="panel-card">
        <h2>Attendance</h2>

        <!-- SETTINGS -->
        <div class="settings-bar">
          <label class="field compact">
            <span>Region</span>
            <select id="att-region">
              <option value="EMEA">Europe</option>
              <option value="US">Americas</option>
              <option value="CN">Greater China</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="SEAO">Southeast Asia</option>
            </select>
          </label>

          <label class="field compact">
            <span>Start date</span>
            <input id="att-start" type="date"/>
          </label>

          <!-- IMPORTANT COULEUR DU BOUTON : variable --btn (#1E5631) dans styles.css -->
          <button id="att-calc" class="primary">Calculate</button>
        </div>

        <!-- ADHERENCE BAR -->
        <div class="adherence-wrap">
          <div class="adherence-head">
            <span class="adherence-title">Adherence</span>
            <span id="adherence-label" class="adherence-value">– %</span>
          </div>
          <div class="adherence-bar">
            <!-- IMPORTANT COULEURS : --adherence-fill (#1C4966), --adherence-bg (#FFF7E0) -->
            <div id="adherence-fill" class="adherence-fill" style="width:0%"></div>
          </div>
          <small class="adherence-notes">Definition: available agents / required agents (higher is better).</small>
        </div>

        <!-- GRID (3.2 complet) -->
        <div class="calendar-wrap">
          <div class="grid-topbar">
            <div id="att-warnings" class="warning-row"></div>
            <!-- IMPORTANT COULEUR DU BOUTON : variable --btn (#1E5631) dans styles.css -->
            <button id="att-export" class="secondary">Export CSV</button>
          </div>

          <div class="calendar-scroll">
            <table id="att-table" class="calendar-table">
              <!-- Head + body remplis en JS -->
            </table>
          </div>

          <small class="legend">
            Legend:
            <span class="legend-box present"></span> Present
            <span class="legend-box pto"></span> PTO
            <span class="legend-box pto-half"></span> Half-day PTO
          </small>
        </div>
      </div>
    </section>

<!-- === WEEKLY PLANNING (Tab Panel) START -->
<section id="weekly" class="tab-panel" hidden>
  <div class="panel-card">
    <h2>Weekly Planning</h2>

    <!-- Toolbar -->
    <div class="wp-toolbar">
      <label class="field compact">
        <span>Region</span>
        <select id="wp-region">
          <option value="EMEA">Europe</option>
          <option value="US">Americas</option>
          <option value="CN">Greater China</option>
          <option value="JP">Japan</option>
          <option value="KR">South Korea</option>
          <option value="SEAO">Southeast Asia</option>
        </select>
      </label>

      <label class="field compact">
        <span>ISO Week</span>
        <input id="wp-week" type="week" />
      </label>

      <label class="field compact">
        <span>Day start</span>
        <input id="wp-day-start" type="time" value="09:00" />
      </label>

      <label class="field compact">
        <span>Day end</span>
        <input id="wp-day-end" type="time" value="18:00" />
      </label>

      <div class="wp-actions">
        <button id="wp-load" class="secondary">Load</button>
        <button id="wp-export" class="primary">Export CSV</button>
      </div>
    </div>

    <!-- Summary ribbons -->
    <div class="wp-summaries">
      <div class="wp-chip">
        <span class="k">Agents (present)</span>
        <span id="wp-agents-count" class="v">–</span>
      </div>
      <div class="wp-chip">
        <span class="k">Coverage avg</span>
        <span id="wp-coverage-avg" class="v">– %</span>
      </div>
      <div class="wp-chip">
        <span class="k">Understaffed slots</span>
        <span id="wp-understaffed" class="v">–</span>
      </div>
    </div>

    <!-- Timeline grid -->
    <div class="wp-grid-wrap">
      <table id="wp-grid" class="wp-grid">
        <!-- Head + body seront remplis via app.js -->
      </table>
    </div>

    <!-- Legend -->
    <small class="legend">
      Legend:
      <span class="legend-box present"></span> Present
      <span class="legend-box pto"></span> PTO
      <span class="legend-box gap"></span> Demand gap
      <span class="legend-box over"></span> Over-coverage
    </small>
  </div>
</section>
<!-- === WEEKLY PLANNING (Tab Panel) END -->


    <!-- AGENTS (COMPLET) -->
    <section id="agents" class="tab-panel" hidden>
      <div class="panel-card">
        <h2>Agents</h2>

        <!-- Directory top bar -->
        <div class="agents-topbar">
          <label class="field compact">
            <span>Region</span>
            <select id="ag-region">
              <option value="EMEA">Europe</option>
              <option value="US">Americas</option>
              <option value="CN">Greater China</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="SEAO">Southeast Asia</option>
            </select>
          </label>

          <div class="agents-actions">
            <!-- IMPORTANT COULEURS DES BOUTONS : --btn (#1E5631) / --btn-text (#fff) -->
            <button id="ag-add" class="primary">Add agent</button>
            <button id="ag-export" class="secondary">Export CSV</button>
          </div>
        </div>

        <!-- Directory table -->
        <div class="agents-table-wrap">
          <table id="ag-table" class="agents-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Region</th>
                <th>Status</th>
                <th>Call</th>
                <th>Mail</th>
                <th>Chat</th>
                <th>Clienteling</th>
                <th>Fraud</th>
                <th>Back Office</th>
                <th>PTO</th>
                <th>Calendar</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody><!-- rempli en JS --></tbody>
          </table>
        </div>
      </div>
    </section>

<!-- TASKS (v1) -->
<section id="tasks" class="tab-panel" hidden>
   <div class="tasks" id="tasksPanel">
    <!-- Toolbar -->
    <div class="toolbar">
      <input id="task-search" type="search" placeholder="Search tasks..." />
      <select id="task-filter-priority">
        <option value="">All priorities</option>
        <option value="low">Low</option>
        <option value="med">Medium</option>
        <option value="high">High</option>
      </select>
      <select id="task-filter-status">
        <option value="">All status</option>
        <option value="open">Open</option>
        <option value="progress">In progress</option>
        <option value="done">Done</option>
      </select>
      <select id="task-filter-owner">
        <option value="">All owners</option>
      </select>

      <!-- Bouton demandé -->
      <button id="createTaskBtn" class="btn primary" type="button">Create task</button>
    </div>

    <!-- Compteurs -->
    <div class="counters" id="task-counters">
      <!-- rempli en JS -->
    </div>

    <!-- Liste -->
    <div class="task-list" id="task-list">
      <!-- items injectés en JS -->
    </div>

    <!-- Formulaire (caché par défaut, affiché quand Create task) -->
    <form id="task-form" hidden>
      <div class="row">
        <input type="text" id="tf-title" placeholder="Task title" required />
        <select id="tf-owner"></select>
      </div>
      <div class="row">
        <select id="tf-priority" required>
          <option value="low">Low (P3)</option>
          <option value="med">Medium (P2)</option>
          <option value="high">High (P1)</option>
        </select>
        <select id="tf-status" required>
          <option value="open">Open</option>
          <option value="progress">In progress</option>
          <option value="done">Done</option>
        </select>
      </div>
      <textarea id="tf-notes" rows="3" placeholder="Notes (optional)"></textarea>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button type="button" id="tf-cancel" class="btn">Cancel</button>
        <button type="submit" class="btn primary">Save task</button>
      </div>
    </form>
  </div>
</section>


<!-- === FORECAST (Tab Panel) START -->
<section id="forecast-section" class="tab-panel" hidden>
  <div class="panel-card">
    <h2>Forecast — Data Editor</h2>

    <div class="forecast-toolbar">
      <label class="field compact">
        <span>Region</span>
        <select id="fc-region">
          <option value="EMEA">Europe</option>
          <option value="US">Americas</option>
          <option value="CN">Greater China</option>
          <option value="JP">Japan</option>
          <option value="KR">South Korea</option>
          <option value="SEAO">Southeast Asia</option>
        </select>
      </label>

      <label class="field compact">
        <span>Month (context)</span>
        <input type="month" id="fc-month" />
      </label>

      <button id="fc-load" class="secondary">Load</button>
    </div>

    <div class="forecast-section-card">
      <h3>Totals</h3>
      <div class="grid-1-3">
        <label class="field compact">
          <span>Total yearly volume</span>
          <input type="number" id="fc-total" min="0" step="1" />
        </label>
        <div class="muted">Volume annuel total, toutes tâches confondues.</div>
        <button id="fc-save-total" class="primary">Save totals</button>
      </div>
    </div>

    <div class="forecast-section-card">
      <h3>Monthly shares (sum = 100%)</h3>
      <div id="fc-monthly" class="forecast-table"></div>
      <div class="forecast-actions">
        <span id="fc-monthly-sum" class="muted"></span>
        <button id="fc-save-monthly" class="primary">Save monthly</button>
      </div>
    </div>

    <div class="forecast-section-card">
      <h3>Weekly shares (1–53) (guide ≈ 100%)</h3>
      <div id="fc-weekly" class="forecast-table"></div>
      <div class="forecast-actions">
        <span id="fc-weekly-sum" class="muted"></span>
        <button id="fc-save-weekly" class="primary">Save weekly</button>
      </div>
    </div>

    <div class="forecast-section-card">
      <h3>Daily shares & channel mix</h3>
      <div class="muted">7 lignes (Mon→Sun). “Day %” doit totaliser 100% sur la semaine. Chaque ligne Mail/Call/… doit totaliser 100%.</div>
      <div id="fc-daily" class="forecast-table"></div>
      <div class="forecast-actions">
        <span id="fc-daily-check" class="muted"></span>
        <button id="fc-save-daily" class="primary">Save daily</button>
      </div>
    </div>

    <div class="forecast-section-card">
      <h3>Hourly shares (0–23) (sum = 100%)</h3>
      <div id="fc-hourly" class="forecast-table"></div>
      <div class="forecast-actions">
        <span id="fc-hourly-sum" class="muted"></span>
        <button id="fc-save-hourly" class="primary">Save hourly</button>
      </div>
    </div>
  </div>
</section>
<!-- === FORECAST (Tab Panel) END -->


<!-- ============ TAB: REGULATION ============ -->
<section id="regulation" class="tab-panel" role="region" aria-labelledby="tab-regulation" hidden>
  <div class="container">
    <header class="section-header">
      <h2>Regulation & Constraints</h2>
      <p class="muted">
        Définis les règles globales de planning et l’application automatique des contraintes.
      </p>
    </header>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="left">
        <label class="switch">
          <input type="checkbox" id="enforceRegulationsToggle" />
          <span class="slider"></span>
        </label>
        <label for="enforceRegulationsToggle" class="switch-label">Activer l’application automatique des règles</label>
      </div>
      <div class="right">
        <button id="addRuleBtn" class="btn primary">Ajouter une règle</button>
        <button id="validateAllBtn" class="btn">Vérifier tout le planning</button>
      </div>
    </div>

    <!-- Résumé rapide -->
    <div class="cards-grid" id="regulationSummary">
      <div class="card">
        <div class="card-title">Règles actives</div>
        <div class="card-value" id="activeRulesCount">0</div>
      </div>
      <div class="card">
        <div class="card-title">Infractions détectées</div>
        <div class="card-value warn" id="violationsCount">0</div>
      </div>
      <div class="card">
        <div class="card-title">Dernière vérification</div>
        <div class="card-value" id="lastValidationAt">–</div>
      </div>
    </div>

    <!-- Table des règles -->
    <div class="card">
      <div class="card-header">
        <h3>Liste des règles</h3>
        <div class="grow"></div>
        <input id="ruleSearch" type="search" placeholder="Rechercher une règle…" class="input">
      </div>
      <div class="table-wrapper">
        <table class="table" id="regulationTable" aria-describedby="regulation-table-caption">
          <caption id="regulation-table-caption" class="sr-only">Règles de planning</caption>
          <thead>
            <tr>
              <th>Nom</th>
              <th>Type</th>
              <th>Paramètres</th>
              <th>Scope</th>
              <th>Statut</th>
              <th style="width:120px">Actions</th>
            </tr>
          </thead>
          <tbody id="regulationTableBody">
            <!-- Lignes injectées par app.js -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Panneau d’alertes / violations -->
    <div class="card" id="violationsPanel" hidden>
      <div class="card-header">
        <h3>Infractions détectées</h3>
        <div class="grow"></div>
        <button id="exportViolationsBtn" class="btn">Exporter CSV</button>
      </div>
      <div class="table-wrapper">
        <table class="table" id="violationsTable" aria-describedby="violations-table-caption">
          <caption id="violations-table-caption" class="sr-only">Infractions de règles</caption>
          <thead>
            <tr>
              <th>Règle</th>
              <th>Agent</th>
              <th>Date / Shift</th>
              <th>Détail</th>
              <th>Gravité</th>
            </tr>
          </thead>
          <tbody id="violationsTableBody">
            <!-- Lignes injectées par app.js -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal: Créer / Éditer une règle -->
  <dialog id="ruleModal" class="modal">
    <form method="dialog" class="modal-box" id="ruleForm">
      <header class="modal-header">
        <h3 id="ruleModalTitle">Nouvelle règle</h3>
        <button type="button" class="icon-btn" id="closeRuleModal" aria-label="Fermer">✕</button>
      </header>

      <div class="form-grid">
        <div class="form-field">
          <label for="ruleName">Nom de la règle</label>
          <input id="ruleName" name="name" type="text" class="input" required placeholder="Ex: Max heures / semaine">
        </div>

        <div class="form-field">
          <label for="ruleType">Type</label>
          <select id="ruleType" name="type" class="input" required>
            <option value="" disabled selected>Choisir un type…</option>
            <option value="MAX_HOURS_PER_WEEK">Max heures / semaine</option>
            <option value="MIN_REST_BETWEEN_SHIFTS">Repos minimum entre shifts (heures)</option>
            <option value="NO_OVERLAP_SHIFTS">Pas de chevauchement de shifts</option>
            <option value="NO_PTO_OVERBOOKING">Interdiction de planifier pendant PTO</option>
            <option value="HOLIDAY_BLACKOUT">Blackout jours fériés</option>
          </select>
        </div>

        <div class="form-field">
          <label for="ruleParam1" id="ruleParam1Label">Paramètre 1</label>
          <input id="ruleParam1" name="param1" type="number" class="input" placeholder="Ex: 40">
        </div>

        <div class="form-field">
          <label for="ruleParam2" id="ruleParam2Label">Paramètre 2 (optionnel)</label>
          <input id="ruleParam2" name="param2" type="number" class="input" placeholder="Ex: 11">
        </div>

        <div class="form-field">
          <label for="ruleScope">Scope</label>
          <select id="ruleScope" name="scope" class="input">
            <option value="GLOBAL" selected>Global</option>
            <option value="REGION">Par région</option>
            <option value="AGENT">Par agent</option>
          </select>
        </div>

        <div class="form-field" id="scopeTargetField" hidden>
          <label for="ruleScopeTarget" id="scopeTargetLabel">Cible</label>
          <input id="ruleScopeTarget" name="scope_target" type="text" class="input" placeholder="Code région (ex: EMEA) ou Agent ID">
        </div>

        <div class="form-field">
          <label for="ruleSeverity">Gravité</label>
          <select id="ruleSeverity" name="severity" class="input" required>
            <option value="WARN" selected>Avertissement</option>
            <option value="BLOCK">Bloquant</option>
          </select>
        </div>

        <div class="form-field">
          <label class="checkbox">
            <input type="checkbox" id="ruleActive" name="active" checked>
            Activer cette règle
          </label>
        </div>
      </div>

      <footer class="modal-actions">
        <button type="submit" class="btn primary" id="saveRuleBtn">Enregistrer</button>
        <button type="button" class="btn" id="cancelRuleBtn">Annuler</button>
      </footer>

      <!-- Champs techniques -->
      <input type="hidden" id="ruleId" name="id" value="">
    </form>
  </dialog>

  <!-- Dialog confirmation suppression -->
  <dialog id="confirmDeleteModal" class="modal">
    <form method="dialog" class="modal-box">
      <header class="modal-header">
        <h3>Supprimer la règle</h3>
      </header>
      <p>Confirmer la suppression de cette règle ? Cette action est irréversible.</p>
      <footer class="modal-actions">
        <button type="submit" class="btn danger" id="confirmDeleteBtn">Supprimer</button>
        <button type="button" class="btn" id="cancelDeleteBtn">Annuler</button>
      </footer>
    </form>
  </dialog>
</section>

  </main>

  <!-- Footer -->
<div class="footer">© Roman Inc.</div>

  <!-- Auth Modal (bloquant tant qu’on n’est pas connecté) -->
  <div id="auth-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal">
      <h3>Sign In</h3>

      <label class="field">
        <span>Username (Email)</span>
        <input id="auth-email" type="email" placeholder="name@company.com" autocomplete="username"/>
      </label>

      <label class="field">
        <span>Password</span>
        <input id="auth-password" type="password" placeholder="••••••••" autocomplete="current-password"/>
      </label>

      <div class="region-row">
        <label class="field">
          <span>Region</span>
          <select id="auth-region">
            <option value="EMEA">Europe</option>
            <option value="US">Americas</option>
            <option value="CN">Greater China</option>
            <option value="JP">Japan</option>
            <option value="KR">South Korea</option>
            <option value="SEAO">Southeast Asia</option>
          </select>
        </label>
      </div>

      <div class="auth-actions">
        <!-- IMPORTANT COULEUR DES BOUTONS : voir styles.css (variables --btn / --btn-text) -->
        <button id="login-btn" class="primary">Log in</button>
        <button id="signup-btn" class="secondary">Sign up</button>
        <a id="forgot-link" href="#" class="muted">Forgot password</a>
      </div>

      <p id="auth-error" class="error" role="alert" aria-live="polite"></p>
    </div>
  </div>

  <!-- PTO Drawer (slide-in) -->
  <aside id="pto-drawer" class="drawer" aria-hidden="true">
    <div class="drawer-inner">
      <div class="drawer-head">
        <h3 id="pto-title">PTO for …</h3>
        <button id="pto-close" class="ghost">✕</button>
      </div>

      <div class="drawer-content">
        <div class="drawer-form">
          <label class="field compact">
            <span>Start date</span>
            <input id="pto-start" type="date"/>
          </label>
          <label class="field compact">
            <span>Start half</span>
            <select id="pto-half-start">
              <option value="">Full day</option>
              <option value="AM">AM</option>
              <option value="PM">PM</option>
            </select>
          </label>
          <label class="field compact">
            <span>End date</span>
            <input id="pto-end" type="date"/>
          </label>
          <label class="field compact">
            <span>End half</span>
            <select id="pto-half-end">
              <option value="">Full day</option>
              <option value="AM">AM</option>
              <option value="PM">PM</option>
            </select>
          </label>
        </div>

        <!-- IMPORTANT COULEUR DU BOUTON : --btn (#1E5631) -->
        <button id="pto-save" class="primary">Save PTO</button>

        <div class="drawer-section">
          <h4>Existing PTO</h4>
          <ul id="pto-list" class="list"></ul>
        </div>

        <div class="drawer-section">
          <h4>Mini Calendar</h4>
          <div id="pto-calendar" class="mini-cal"></div>
          <small class="legend">
            <span class="legend-box pto"></span> PTO
            <span class="legend-box pto-half"></span> Half-day
          </small>
        </div>
      </div>
    </div>
  </aside>

  <!-- JS -->
<script src="./config.js" type="module"></script>

<!-- >>> SEED TASKS — À GARDER AVANT app.js <<< -->
<script>
  // Tâches préchargées (ne seront lues qu'une seule fois, puis stockées dans localStorage)
  window.__SEED_TASKS__ = [
    { id:"t1", title:"Fix Attendance calc", owner:"EMEA", priority:"high", status:"open",     notes:"Le tableau est vide — vérifier génération des cases et calcul d’adherence." },
    { id:"t2", title:"Weekly grid render",  owner:"US",   priority:"med",  status:"progress", notes:"Le planning ne charge pas les agents — mapper correctement les IDs." },
    { id:"t3", title:"Forecast UI compact", owner:"EMEA", priority:"low",  status:"done",     notes:"Cellules compactes + pas de bordures rouges = OK." },
    { id:"t4", title:"Create Task button",  owner:"EMEA", priority:"med",  status:"open",     notes:"Bouton présent, vérifier le formulaire et la persistance locale." },
    { id:"t5", title:"Regulation seeding",  owner:"EMEA", priority:"low",  status:"open",     notes:"Préparer 2–3 règles de base pour le rendu (affichage seulement)." }
  ];
</script>

<script src="./app.js" type="module"></script>

</body>
</html>

