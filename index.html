<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ROMAN — Planning Manager</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<header class="topbar">
  <div class="brand">ROMAN <span class="muted">Planning Manager</span></div>
  <nav class="tabs">
    <button class="tab-btn active" data-tab="attendance" aria-selected="true">Attendance</button>
    <button class="tab-btn" data-tab="agents">Agents</button>
    <button class="tab-btn" data-tab="weekly">Weekly Planner</button>
    <button class="tab-btn" data-tab="forecast">Forecast</button>
    <button class="tab-btn" data-tab="regulation">Regulation</button>
    <button class="tab-btn" data-tab="tasks">Tasks</button>
  </nav>
</header>

<main class="container">

  <!-- ATTENDANCE -->
  <section id="attendance" class="tab-panel">
    <h2>Attendance — couverture mensuelle</h2>
    <div class="toolbar">
      <label>Region
        <select id="att-region">
          <option value="EMEA">Europe</option>
          <option value="US">Americas</option>
          <option value="CN">Greater China</option>
          <option value="JP">Japan</option>
          <option value="KR">South Korea</option>
          <option value="SEAO">Southeast Asia</option>
        </select>
      </label>
      <label>Mois (1er jour)
        <input type="date" id="att-start"/>
      </label>
      <button id="att-calc" class="primary">Calculer</button>
      <div class="spacer"></div>
      <div>Adherence <span id="adherence-label">0%</span></div>
    </div>
    <div id="att-warnings" class="warnings"></div>
    <div class="table-wrap">
      <table id="att-table" class="grid"></table>
    </div>
  </section>

  <!-- AGENTS -->
  <section id="agents" class="tab-panel" hidden>
    <h2>Agents</h2>
    <div class="toolbar">
      <label>Region
        <select id="ag-region">
          <option value="EMEA">Europe</option><option value="US">Americas</option>
          <option value="CN">Greater China</option><option value="JP">Japan</option>
          <option value="KR">South Korea</option><option value="SEAO">Southeast Asia</option>
        </select>
      </label>
      <button id="ag-add" class="primary">Add agent</button>
      <button id="ag-export" class="secondary">Exporter CSV</button>
    </div>
    <div class="table-wrap">
      <table id="ag-table" class="table">
        <thead>
          <tr>
            <th>Name</th><th>Region</th><th>Status</th>
            <th>Call</th><th>Mail</th><th>Chat</th><th>Clienteling</th><th>Fraud</th><th>Back Office</th>
            <th>PTO</th><th>Cal</th><th>Del</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- PTO Drawer -->
    <aside id="pto-drawer" class="drawer" aria-hidden="true">
      <div class="drawer-head">
        <h3 id="pto-title">PTO</h3>
        <button id="pto-close" class="icon">✕</button>
      </div>
      <div class="drawer-body">
        <div class="form-row">
          <label>Start <input type="date" id="pto-start"></label>
          <label>End <input type="date" id="pto-end"></label>
        </div>
        <div class="form-row">
          <label>Half start
            <select id="pto-half-start">
              <option value="">Full</option><option>AM</option><option>PM</option>
            </select>
          </label>
          <label>Half end
            <select id="pto-half-end">
              <option value="">Full</option><option>AM</option><option>PM</option>
            </select>
          </label>
        </div>
        <button id="pto-save" class="primary">Add PTO</button>
        <h4>Dates</h4>
        <ul id="pto-list" class="list"></ul>
        <h4>Calendar</h4>
        <div id="pto-calendar"></div>
      </div>
    </aside>
  </section>

  <!-- WEEKLY PLANNER -->
  <section id="weekly" class="tab-panel" hidden>
    <h2>Weekly Planner</h2>
    <div class="toolbar">
      <label>Region
        <select id="wp-region">
          <option value="EMEA">Europe</option><option value="US">Americas</option>
          <option value="CN">Greater China</option><option value="JP">Japan</option>
          <option value="KR">South Korea</option><option value="SEAO">Southeast Asia</option>
        </select>
      </label>
      <label>Semaine <input type="week" id="wp-week"></label>
      <label>Jour: start <input type="time" id="wp-day-start" value="09:00"></label>
      <label>end <input type="time" id="wp-day-end" value="18:00"></label>
      <button id="wp-load" class="primary">Load</button>
      <div class="spacer"></div>
      <div class="pill">Agents avg: <b id="wp-agents-count">0</b></div>
      <div class="pill">Coverage: <b id="wp-coverage-avg">0%</b></div>
      <div class="pill warn">Gaps: <b id="wp-understaffed">0</b></div>
      <button id="wp-export" class="secondary">Export CSV</button>
    </div>
    <div class="table-wrap horizontal">
      <table id="wp-grid" class="grid"></table>
    </div>
  </section>

  <!-- FORECAST -->
  <section id="forecast" class="tab-panel" hidden>
    <h2>Forecast</h2>
    <div class="toolbar">
      <label>Region
        <select id="fc-region">
          <option value="EMEA">Europe</option><option value="US">Americas</option>
          <option value="CN">Greater China</option><option value="JP">Japan</option>
          <option value="KR">South Korea</option><option value="SEAO">Southeast Asia</option>
        </select>
      </label>
      <label>Total annual volume <input id="fc-total" type="number" step="1" placeholder="e.g. 90000"></label>
    </div>

    <div id="forecast-section" class="stack">
      <section>
        <h3>Monthly (1..12) <small id="fc-monthly-sum" class="muted"></small></h3>
        <div id="fc-monthly"></div>
      </section>
      <section>
        <h3>Weekly (1..53) <small id="fc-weekly-sum" class="muted"></small></h3>
        <div id="fc-weekly"></div>
      </section>
      <section>
        <h3>Daily (Mon..Sun) <small id="fc-daily-check" class="muted"></small></h3>
        <div id="fc-daily"></div>
      </section>
      <section>
        <h3>Hourly (30’ slots) <small id="fc-hourly-sum" class="muted"></small></h3>
        <div id="fc-hourly"></div>
      </section>
    </div>
  </section>

  <!-- REGULATION -->
  <section id="regulation" class="tab-panel" hidden>
    <h2>Regulation</h2>
    <div class="toolbar">
      <label class="switch">
        <input type="checkbox" id="enforceRegulationsToggle">
        <span class="slider"></span>
      </label>
      <span class="muted">Enforce</span>
      <button id="addRuleBtn" class="primary">Add rule</button>
      <button id="validateAllBtn" class="secondary">Validate</button>
      <button id="exportViolationsBtn" class="secondary">Export violations</button>
      <div class="spacer"></div>
      <input id="ruleSearch" type="search" placeholder="Search rules…"/>
      <span class="pill">Active: <b id="activeRulesCount">0</b></span>
      <span class="pill">Violations: <b id="violationsCount">0</b></span>
      <span class="muted">Last: <span id="lastValidationAt">—</span></span>
    </div>

    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>Name</th><th>Type</th><th>Params</th><th>Scope</th><th>Status</th><th></th></tr></thead>
        <tbody id="regulationTableBody"></tbody>
      </table>
    </div>

    <section id="violationsPanel" hidden>
      <h3>Violations</h3>
      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>Rule</th><th>Agent</th><th>Shift</th><th>Detail</th><th>Severity</th></tr></thead>
          <tbody id="violationsTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Rule modal -->
    <dialog id="ruleModal" class="modal">
      <form id="ruleForm" method="dialog">
        <h3 id="ruleModalTitle">Rule</h3>
        <input type="hidden" id="ruleId"/>
        <div class="form-grid">
          <label>Name <input id="ruleName" required></label>
          <label>Type
            <select id="ruleType" required>
              <option value="MAX_HOURS_PER_WEEK">MAX_HOURS_PER_WEEK</option>
              <option value="MIN_REST_BETWEEN_SHIFTS">MIN_REST_BETWEEN_SHIFTS</option>
              <option value="NO_OVERLAP_SHIFTS">NO_OVERLAP_SHIFTS</option>
              <option value="NO_PTO_OVERBOOKING">NO_PTO_OVERBOOKING</option>
              <option value="HOLIDAY_BLACKOUT">HOLIDAY_BLACKOUT</option>
            </select>
          </label>
          <label id="ruleParam1Label">Paramètre 1 <input id="ruleParam1" type="number" step="0.1"></label>
          <label id="ruleParam2Label">Paramètre 2 <input id="ruleParam2" type="number" step="0.1"></label>
          <label>Scope
            <select id="ruleScope">
              <option value="GLOBAL">GLOBAL</option>
              <option value="REGION">REGION</option>
              <option value="AGENT">AGENT</option>
            </select>
          </label>
          <label id="scopeTargetField"><span id="scopeTargetLabel">Target</span>
            <input id="ruleScopeTarget" placeholder="">
          </label>
          <label>Severity
            <select id="ruleSeverity">
              <option value="WARN">WARN</option>
              <option value="BLOCK">BLOCK</option>
            </select>
          </label>
          <label>Active <input type="checkbox" id="ruleActive" checked></label>
        </div>
        <div class="modal-actions">
          <button class="secondary" id="cancelRuleBtn">Cancel</button>
          <button class="primary" type="submit">Save</button>
        </div>
        <button id="closeRuleModal" class="modal-close" type="button">✕</button>
      </form>
    </dialog>

    <!-- Delete confirm -->
    <dialog id="confirmDeleteModal" class="modal">
      <p>Delete this rule?</p>
      <div class="modal-actions">
        <button id="cancelDeleteBtn" class="secondary">Cancel</button>
        <button id="confirmDeleteBtn" class="danger">Delete</button>
      </div>
    </dialog>
  </section>

  <!-- TASKS -->
  <section id="tasks" class="tab-panel" hidden>
    <h2>Tasks</h2>
    <div class="toolbar">
      <label>Region
        <select id="task-region">
          <option value="EMEA">Europe</option><option value="US">Americas</option>
          <option value="CN">Greater China</option><option value="JP">Japan</option>
          <option value="KR">South Korea</option><option value="SEAO">Southeast Asia</option>
        </select>
      </label>
      <input id="task-search" type="search" placeholder="Search…"/>
      <select id="task-filter-priority">
        <option value="">All</option>
        <option value="high">High (P1)</option>
        <option value="med">Medium (P2)</option>
        <option value="low">Low (P3)</option>
      </select>
      <div class="spacer"></div>
      <span id="task-counters" class="pill">—</span>
      <button id="createTaskBtn" class="primary">New task</button>
    </div>
    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>Label</th><th>Priority</th><th>AHT (min)</th><th>Enabled</th><th>Notes</th><th></th></tr></thead>
        <tbody id="tasksTbody"></tbody>
      </table>
    </div>
  </section>

</main>

<footer class="footer">
  © ROMAN — Prototype
</footer>

<!-- Load order matters: supabase → config → app -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>
<script src="app.js"></script>
</body>
</html>
