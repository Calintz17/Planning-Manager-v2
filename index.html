<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ROMAN | Resource Optimization & Management Allocation Network</title>

  <style>html, body { font-family: Helvetica, Arial, sans-serif; }</style>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Header / Tabs -->
  <header class="app-header">
    <div class="site-title">
      <span class="brand">ROMAN</span>
      <span class="tagline">Resource Optimization &amp; Management Allocation Network</span>
    </div>
    <nav class="tabs">
      <button class="tab-btn active" data-tab="attendance">Attendance</button>
      <button class="tab-btn" data-tab="weekly">Weekly Planning</button>
      <button class="tab-btn" data-tab="agents">Agents</button>
      <button class="tab-btn" data-tab="tasks">Tasks</button>
      <button class="tab-btn" data-tab="forecast-section">Forecast</button>
      <button class="tab-btn" data-tab="regulation">Regulation</button>
    </nav>
  </header>

  <!-- Main panels -->
  <main class="app-main container">
    <!-- ATTENDANCE -->
    <section id="attendance" class="tab-panel">
      <div class="panel-card">
        <h2>Attendance</h2>

        <div class="settings-bar row" style="flex-wrap:wrap">
          <label class="field compact">
            <span>Region</span>
            <select id="att-region">
              <option value="EMEA">Europe</option>
              <option value="US">Americas</option>
              <option value="CN">Greater China</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="SEAO">Southeast Asia</option>
            </select>
          </label>

          <label class="field compact">
            <span>Start date</span>
            <input id="att-start" type="date"/>
          </label>

          <button id="att-calc" class="primary">Calculate</button>
        </div>

        <div class="adherence-wrap">
          <div class="adherence-head">
            <span class="adherence-title">Adherence</span>
            <span id="adherence-label" class="adherence-value">– %</span>
          </div>
          <div class="adherence-bar">
            <div id="adherence-fill" class="adherence-fill" style="width:0%"></div>
          </div>
          <small class="adherence-notes">Definition: available agents / required agents (higher is better).</small>
        </div>

        <div class="calendar-wrap">
          <div class="grid-topbar row" style="justify-content:space-between">
            <div id="att-warnings" class="warning-row"></div>
            <button id="att-export" class="secondary">Export CSV</button>
          </div>

          <div class="calendar-scroll">
            <table id="att-table" class="calendar-table"></table>
          </div>

          <small class="legend">
            Legend:
            <span class="legend-box present"></span> Present
            <span class="legend-box pto"></span> PTO
            <span class="legend-box pto-half"></span> Half-day PTO
          </small>
        </div>
      </div>
    </section>

    <!-- WEEKLY -->
    <section id="weekly" class="tab-panel" hidden>
      <div class="panel-card">
        <h2>Weekly Planning</h2>
        <div class="wp-toolbar">
          <label class="field compact"><span>Region</span>
            <select id="wp-region">
              <option value="EMEA">Europe</option>
              <option value="US">Americas</option>
              <option value="CN">Greater China</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="SEAO">Southeast Asia</option>
            </select>
          </label>

          <label class="field compact"><span>ISO Week</span><input id="wp-week" type="week" /></label>
          <label class="field compact"><span>Day start</span><input id="wp-day-start" type="time" value="09:00" /></label>
          <label class="field compact"><span>Day end</span><input id="wp-day-end" type="time" value="21:00" /></label>

          <div class="wp-actions">
            <button id="wp-load" class="secondary">Load</button>
            <button id="wp-export" class="primary">Export CSV</button>
          </div>
        </div>

        <div class="wp-summaries">
          <div class="wp-chip"><span class="k">Agents (present)</span><span id="wp-agents-count" class="v">–</span></div>
          <div class="wp-chip"><span class="k">Coverage avg</span><span id="wp-coverage-avg" class="v">– %</span></div>
          <div class="wp-chip"><span class="k">Understaffed slots</span><span id="wp-understaffed" class="v">–</span></div>
        </div>

        <div class="wp-grid-wrap">
          <table id="wp-grid" class="wp-grid"></table>
        </div>

        <small class="legend">
          Legend:
          <span class="legend-box present"></span> Present
          <span class="legend-box pto"></span> PTO
          <span class="legend-box gap"></span> Demand gap
          <span class="legend-box over"></span> Over-coverage
        </small>
      </div>
    </section>

    <!-- AGENTS -->
    <section id="agents" class="tab-panel" hidden>
      <div class="panel-card">
        <h2>Agents</h2>
        <div class="agents-topbar row" style="justify-content:space-between;flex-wrap:wrap">
          <label class="field compact"><span>Region</span>
            <select id="ag-region">
              <option value="EMEA">Europe</option>
              <option value="US">Americas</option>
              <option value="CN">Greater China</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="SEAO">Southeast Asia</option>
            </select>
          </label>

          <div class="agents-actions">
            <button id="ag-add" class="primary">Add agent</button>
            <button id="ag-export" class="secondary">Export CSV</button>
          </div>
        </div>

        <div class="agents-table-wrap">
          <table id="ag-table" class="agents-table table">
            <thead>
              <tr>
                <th>Name</th><th>Region</th><th>Status</th><th>Call</th><th>Mail</th>
                <th>Chat</th><th>Clienteling</th><th>Fraud</th><th>Back Office</th>
                <th>PTO</th><th>Calendar</th><th>Delete</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- TASKS -->
    <section id="tasks" class="tab-panel" hidden>
      <div class="tasks" id="tasksPanel">
        <div class="toolbar">
          <input id="task-search" type="search" placeholder="Search tasks..." />
          <select id="task-region" title="Region">
            <option value="EMEA">Europe</option>
            <option value="US">Americas</option>
            <option value="CN">Greater China</option>
            <option value="JP">Japan</option>
            <option value="KR">South Korea</option>
            <option value="SEAO">Southeast Asia</option>
          </select>
          <select id="task-filter-priority" title="Priority filter">
            <option value="">All priorities</option>
            <option value="high">High (P1)</option>
            <option value="med">Medium (P2)</option>
            <option value="low">Low (P3)</option>
          </select>
          <button id="createTaskBtn" class="btn primary" type="button">Create task</button>
        </div>

        <div class="table-wrapper">
          <table class="table" id="tasksTable">
            <thead>
              <tr>
                <th>Task</th><th>Priority</th><th>Avg Handle Time (min)</th>
                <th>Enabled</th><th>Notes</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="tasksTbody"></tbody>
          </table>
        </div>

        <div class="counters" id="task-counters"></div>
      </div>
    </section>

    <!-- FORECAST -->
    <section id="forecast-section" class="tab-panel" hidden>
      <div class="panel-card">
        <h2>Forecast — Data Editor</h2>
        <div class="forecast-toolbar">
          <label class="field compact"><span>Region</span>
            <select id="fc-region">
              <option value="EMEA">Europe</option>
              <option value="US">Americas</option>
              <option value="CN">Greater China</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="SEAO">Southeast Asia</option>
            </select>
          </label>
          <label class="field compact"><span>Month (context)</span><input type="month" id="fc-month" /></label>
          <button id="fc-load" class="secondary">Load</button>
        </div>

        <div class="forecast-section-card">
          <h3>Totals</h3>
          <div class="grid-1-3">
            <label class="field compact"><span>Total yearly volume</span><input type="number" id="fc-total" /></label>
            <div class="muted">Volume annuel total, toutes tâches confondues.</div>
            <button id="fc-save-total" class="primary">Save totals</button>
          </div>
        </div>

        <div class="forecast-section-card">
          <h3>Monthly shares (sum = 100%)</h3>
          <div id="fc-monthly" class="forecast-table"></div>
          <div class="forecast-actions"><span id="fc-monthly-sum" class="muted"></span><button id="fc-save-monthly" class="primary">Save monthly</button></div>
        </div>

        <div class="forecast-section-card">
          <h3>Weekly shares (1–53) (guide ≈ 100%)</h3>
          <div id="fc-weekly" class="forecast-table"></div>
          <div class="forecast-actions"><span id="fc-weekly-sum" class="muted"></span><button id="fc-save-weekly" class="primary">Save weekly</button></div>
        </div>

        <div class="forecast-section-card">
          <h3>Daily shares & channel mix</h3>
          <div class="muted">7 lignes (Mon→Sun)...</div>
          <div id="fc-daily" class="forecast-table"></div>
          <div class="forecast-actions"><span id="fc-daily-check" class="muted"></span><button id="fc-save-daily" class="primary">Save daily</button></div>
        </div>

        <div class="forecast-section-card">
          <h3>Hourly shares (0–23) (sum = 100%)</h3>
          <div id="fc-hourly" class="forecast-table"></div>
          <div class="forecast-actions"><span id="fc-hourly-sum" class="muted"></span><button id="fc-save-hourly" class="primary">Save hourly</button></div>
        </div>
      </div>
    </section>

    <!-- REGULATION -->
    <section id="regulation" class="tab-panel" hidden>
      <div class="container">
        <header class="section-header">
          <h2>Regulation & Constraints</h2>
          <p class="muted">Define global planning rules.</p>
        </header>

        <div class="toolbar row" style="justify-content:space-between;flex-wrap:wrap">
          <div class="left">
            <label class="switch"><input type="checkbox" id="enforceRegulationsToggle"/><span class="slider"></span></label>
            <label for="enforceRegulationsToggle" class="switch-label">Apply rules automatically</label>
          </div>
          <div class="right">
            <button id="addRuleBtn" class="btn primary">Add Rule</button>
            <button id="validateAllBtn" class="btn">Validate all</button>
          </div>
        </div>

        <div class="cards-grid" id="regulationSummary">
          <div class="card"><div class="card-title">Active rules</div><div class="card-value" id="activeRulesCount">0</div></div>
          <div class="card"><div class="card-title">Violations</div><div class="card-value warn" id="violationsCount">0</div></div>
          <div class="card"><div class="card-title">Last check</div><div class="card-value" id="lastValidationAt">–</div></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Rules list</h3>
            <div class="grow"></div>
            <input id="ruleSearch" type="search" placeholder="Search..." class="input">
          </div>
          <div class="table-wrapper">
            <table class="table" id="regulationTable">
              <thead>
                <tr><th>Name</th><th>Type</th><th>Params</th><th>Scope</th><th>Status</th><th>Actions</th></tr>
              </thead>
              <tbody id="regulationTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Violations panel -->
        <div class="card" id="violationsPanel" hidden>
          <div class="card-header">
            <h3>Violations</h3>
            <div class="grow"></div>
            <button id="exportViolationsBtn" class="btn secondary">Export CSV</button>
          </div>
          <div class="table-wrapper">
            <table class="table">
              <thead><tr><th>Rule</th><th>Agent</th><th>Shift</th><th>Detail</th><th>Severity</th></tr></thead>
              <tbody id="violationsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <div class="footer">© Roman Inc.</div>

  <!-- Auth Modal -->
  <div id="auth-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal">
      <h3>Sign In</h3>
      <label class="field"><span>Email</span><input id="auth-email" type="email" /></label>
      <label class="field"><span>Password</span><input id="auth-password" type="password" /></label>
      <label class="field"><span>Region</span>
        <select id="auth-region">
          <option value="EMEA">Europe</option><option value="US">Americas</option>
          <option value="CN">Greater China</option><option value="JP">Japan</option>
          <option value="KR">South Korea</option><option value="SEAO">Southeast Asia</option>
        </select>
      </label>
      <div class="auth-actions">
        <button id="login-btn" class="primary">Log in</button>
        <button id="signup-btn" class="secondary">Sign up</button>
        <a id="forgot-link" href="#" class="muted">Forgot password?</a>
      </div>
      <p id="auth-error" class="error" role="alert"></p>
    </div>
  </div>

  <!-- PTO Drawer (Agents) -->
  <aside id="pto-drawer" class="drawer" aria-hidden="true">
    <div class="drawer-inner">
      <div class="drawer-head">
        <h3 id="pto-title">PTO</h3>
        <button id="pto-close" class="btn">Close</button>
      </div>
      <div class="drawer-content">
        <div class="form-grid">
          <div class="form-field">
            <label><span>Start date</span><input type="date" id="pto-start"></label>
          </div>
          <div class="form-field">
            <label><span>End date</span><input type="date" id="pto-end"></label>
          </div>
          <div class="form-field">
            <label><span>Half-day start</span>
              <select id="pto-half-start">
                <option value="">Full</option>
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </label>
          </div>
          <div class="form-field">
            <label><span>Half-day end</span>
              <select id="pto-half-end">
                <option value="">Full</option>
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </label>
          </div>
        </div>

        <div style="margin-top:12px">
          <button id="pto-save" class="btn primary">Save PTO</button>
        </div>

        <h4 style="margin-top:16px">This month</h4>
        <div id="pto-calendar" class="ghost" style="padding:8px;border-radius:10px"></div>

        <h4 style="margin-top:16px">Existing ranges</h4>
        <ul id="pto-list"></ul>
      </div>
    </div>
  </aside>

  <!-- Regulation: Rule Modal -->
  <dialog id="ruleModal" class="modal">
    <div class="modal-box">
      <div class="modal-header">
        <h3 id="ruleModalTitle">New rule</h3>
        <button id="closeRuleModal" class="btn">Close</button>
      </div>
      <form id="ruleForm">
        <input type="hidden" id="ruleId" />
        <div class="form-grid">
          <div class="form-field">
            <label class="field"><span>Name</span><input id="ruleName" type="text" required></label>
          </div>
          <div class="form-field">
            <label class="field">
              <span>Type</span>
              <select id="ruleType" required>
                <option value="">—</option>
                <option value="MAX_HOURS_PER_WEEK">MAX_HOURS_PER_WEEK</option>
                <option value="MIN_REST_BETWEEN_SHIFTS">MIN_REST_BETWEEN_SHIFTS</option>
                <option value="NO_OVERLAP_SHIFTS">NO_OVERLAP_SHIFTS</option>
                <option value="NO_PTO_OVERBOOKING">NO_PTO_OVERBOOKING</option>
                <option value="HOLIDAY_BLACKOUT">HOLIDAY_BLACKOUT</option>
              </select>
            </label>
          </div>
          <div class="form-field">
            <label class="field"><span id="ruleParam1Label">Param 1</span><input id="ruleParam1" type="number"></label>
          </div>
          <div class="form-field">
            <label class="field"><span id="ruleParam2Label">Param 2</span><input id="ruleParam2" type="number"></label>
          </div>
          <div class="form-field">
            <label class="field">
              <span>Scope</span>
              <select id="ruleScope">
                <option value="GLOBAL">GLOBAL</option>
                <option value="REGION">REGION</option>
                <option value="AGENT">AGENT</option>
              </select>
            </label>
          </div>
          <div class="form-field" id="scopeTargetField" hidden>
            <label class="field"><span id="scopeTargetLabel">Target</span><input id="ruleScopeTarget" type="text"></label>
          </div>
          <div class="form-field">
            <label class="field"><span>Severity</span>
              <select id="ruleSeverity">
                <option value="WARN">WARN</option>
                <option value="BLOCK">BLOCK</option>
              </select>
            </label>
          </div>
          <div class="form-field">
            <label class="field"><span>Active</span>
              <label class="switch"><input type="checkbox" id="ruleActive" checked><span class="slider"></span></label>
            </label>
          </div>
        </div>
        <div class="modal-actions">
          <button id="cancelRuleBtn" type="button" class="btn">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- Regulation: Confirm Delete Modal -->
  <dialog id="confirmDeleteModal" class="modal">
    <div class="modal-box">
      <div class="modal-header">
        <h3>Delete rule</h3>
      </div>
      <p>Are you sure you want to delete this rule?</p>
      <div class="modal-actions">
        <button id="cancelDeleteBtn" class="btn">Cancel</button>
        <button id="confirmDeleteBtn" class="btn danger">Delete</button>
      </div>
    </div>
  </dialog>

  <!-- Supabase library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Config + App -->
  <script type="module" src="config.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
